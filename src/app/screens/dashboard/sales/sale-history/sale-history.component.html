<div class="history-container">

  <header class="history-header">
    <h1>Historial de Ventas</h1>
    <p>Consulta y gestiona todas las transacciones realizadas</p>
  </header>

  <div class="table-container mat-elevation-z8">

    <div *ngIf="isLoading" class="loading-spinner">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando historial de ventas...</p>
    </div>

    <table mat-table [dataSource]="dataSource" *ngIf="!isLoading">

      <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let sale" class="date-cell">
          <mat-icon class="mini-icon">calendar_today</mat-icon>
          {{sale.created_at | date:'short'}}
        </td>
      </ng-container>

      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> N° Ticket </th>
        <td mat-cell *matCellDef="let sale" class="ticket-cell">
          <span class="ticket-badge">#{{sale.id}}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="client_name">
        <th mat-header-cell *matHeaderCellDef> Cliente </th>
        <td mat-cell *matCellDef="let sale" class="user-cell">
          <div class="user-info">
            <mat-icon>person</mat-icon>
            {{sale.client_name || sale.client}}
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="items">
        <th mat-header-cell *matHeaderCellDef> Productos </th>
        <td mat-cell *matCellDef="let sale" class="items-cell">
          <span class="items-badge">
            <mat-icon>shopping_cart</mat-icon>
            {{getTotalItems(sale)}} items
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef> Total </th>
        <td mat-cell *matCellDef="let sale" class="total-cell">
          {{sale.total | currency}}
        </td>
      </ng-container>

      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef class="actions-header"> Acciones </th>
        <td mat-cell *matCellDef="let sale" class="actions-cell">
          <button mat-icon-button
                  (click)="viewSaleDetails(sale)"
                  matTooltip="Ver detalles del ticket"
                  class="view-btn">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="data-row"></tr>

    </table>

    <div *ngIf="!isLoading && dataSource.length === 0" class="empty-state">
      <mat-icon>history</mat-icon>
      <p>No hay ventas registradas aún.</p>
    </div>
  </div>

</div>
