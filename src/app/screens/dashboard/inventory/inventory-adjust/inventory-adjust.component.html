<div class="inventory-container">

  <header class="inventory-header">
    <div class="header-content">
      <h1>Ajustes e Historial de Inventario</h1>
      <p>Registra entradas, salidas y mermas de productos</p>
    </div>
    <button mat-raised-button class="create-btn" (click)="openAdjustDialog()">
      <mat-icon>add_circle</mat-icon>
      Registrar Ajuste
    </button>
  </header>

  <div class="table-container mat-elevation-z8">

    <div *ngIf="isLoading" class="loading-spinner">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando movimientos de inventario...</p>
    </div>

    <table mat-table [dataSource]="dataSource" *ngIf="!isLoading">

      <ng-container matColumnDef="timestamp">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let mov" class="date-cell">
          <div class="cell-content">
            <mat-icon class="mini-icon">event</mat-icon>
            {{mov.timestamp | date:'medium'}}
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="product">
        <th mat-header-cell *matHeaderCellDef> Producto </th>
        <td mat-cell *matCellDef="let mov" class="product-cell">
          <span class="product-name">{{mov.product_name}}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef> Tipo </th>
        <td mat-cell *matCellDef="let mov" class="type-cell">
          <span class="status-badge"
                [class.entrada]="mov.type === 'in'"
                [class.salida]="mov.type === 'out'"
                [class.merma]="mov.type === 'loss'">
            {{ mov.type === 'in' ? 'Entrada' : (mov.type === 'out' ? 'Salida' : 'Merma') }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef> Cantidad </th>
        <td mat-cell *matCellDef="let mov" class="amount-cell">
          <span class="amount-value">{{mov.quantity}}</span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="data-row"></tr>

    </table>

    <div *ngIf="!isLoading && dataSource.length === 0" class="empty-state">
      <mat-icon>history_toggle_off</mat-icon>
      <p>No hay movimientos registrados.</p>
    </div>

    <mat-paginator
      *ngIf="!isLoading && totalItems > 0"
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageIndex]="currentPage"
      [hidePageSize]="true"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </div>

</div>
