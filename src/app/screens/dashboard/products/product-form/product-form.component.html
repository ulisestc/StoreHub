<mat-toolbar class="page-header">
  <a mat-icon-button routerLink="/dashboard/products" aria-label="Volver a la lista">
    <mat-icon>arrow_back</mat-icon>
  </a>
  <span>{{ pageTitle }}</span>
</mat-toolbar>

<div class="form-container">
  <mat-card>
    <mat-card-content>

      <!-- Spinner mientras se cargan los datos -->
      <div class="loading-spinner" *ngIf="isLoading">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Cargando datos del producto...</p>
      </div>

      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field" subscriptSizing="dynamic">
            <mat-label>Nombre del Producto</mat-label>
            <input matInput formControlName="name" required>
            <mat-icon matSuffix>inventory_2</mat-icon>
            <mat-error *ngIf="hasError('name')">
              {{ getErrorMessage('name') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field" subscriptSizing="dynamic">
            <mat-label>Código de Barras (SKU)</mat-label>
            <input matInput formControlName="sku" required>
            <mat-icon matSuffix>qr_code</mat-icon>
            <mat-error *ngIf="hasError('sku')">
              {{ getErrorMessage('sku') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field-full" subscriptSizing="dynamic">
            <mat-label>Descripción (Opcional)</mat-label>
            <textarea matInput formControlName="description" rows="3"></textarea>
            <mat-icon matSuffix>description</mat-icon>
            <mat-hint>Máximo 500 caracteres</mat-hint>
            <mat-error *ngIf="hasError('description')">
              {{ getErrorMessage('description') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field" subscriptSizing="dynamic">
            <mat-label>Precio de Venta</mat-label>
            <input matInput type="number" formControlName="price" required min="0" step="0.01">
            <span matTextPrefix>$&nbsp;</span>
            <mat-icon matSuffix>attach_money</mat-icon>
            <mat-error *ngIf="hasError('price')">
              {{ getErrorMessage('price') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field" subscriptSizing="dynamic">
            <mat-label>Costo de Adquisición</mat-label>
            <input matInput type="number" formControlName="cost_price" required min="0" step="0.01">
            <span matTextPrefix>$&nbsp;</span>
            <mat-icon matSuffix>shopping_cart</mat-icon>
            <mat-error *ngIf="hasError('cost_price')">
              {{ getErrorMessage('cost_price') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field" subscriptSizing="dynamic">
            <mat-label>Cantidad en Stock</mat-label>
            <input matInput type="number" formControlName="stock" required min="0">
            <mat-icon matSuffix>inventory</mat-icon>
            <mat-error *ngIf="hasError('stock')">
              {{ getErrorMessage('stock') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field" subscriptSizing="dynamic">
            <mat-label>Categoría</mat-label>
            <mat-select formControlName="category" required>
              <mat-option *ngFor="let cat of categories" [value]="cat.id">
                {{cat.name}}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>category</mat-icon>
            <mat-error *ngIf="hasError('category')">
              {{ getErrorMessage('category') }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field" subscriptSizing="dynamic">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="is_active" required>
              <mat-option *ngFor="let estado of estadosSimulados" [value]="estado.value">
                {{estado.viewValue}}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>toggle_on</mat-icon>
            <mat-error *ngIf="hasError('is_active')">
              {{ getErrorMessage('is_active') }}
            </mat-error>
          </mat-form-field>
        </div>

        <mat-card-actions align="end" class="form-actions">
          <a mat-button routerLink="/dashboard/products" class="cancel-btn">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </a>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="productForm.invalid"
            class="submit-btn">
            <mat-icon>save</mat-icon>
            {{ isEditMode ? 'Actualizar' : 'Guardar' }} Producto
          </button>
        </mat-card-actions>

      </form>
    </mat-card-content>
  </mat-card>
</div>
